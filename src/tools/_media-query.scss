@function px2em($px) {
  @if unitless($px) {
    @return px2em($px * 1px, 16px);
  } @else if unit($px) == em {
    @return $px;
  }
  @return ($px / 16px) * 1em;
}

@mixin mq(
  $from: false,
  $until: false,
  $and: false,
  $media-type: all,
) {
  $min-width: 0;
  $max-width: 0;
  $query: '';

  // FROM: this breakpoint (inclusive)
  @if $from {
    @if type-of($from) == number {
      $min-width: px2em($from);
    } @else {
      $min-width: px2em(map-get($breakpoints, $from));
    }
  }

  // UNTIL: this breakpoint (exclusive)
  @if $until {
    @if type-of($until) == number {
      $max-width: px2em($until - 1px);
    } @else {
      $max-width: px2em(map-get($breakpoints, $until) - 1px);
    }
  }

  @if $min-width != 0 {
    $query: '#{$query} and (min-width: #{$min-width})';
  }
  @if $max-width != 0 {
    $query: '#{$query} and (max-width: #{$max-width})';
  }
  @if $and {
    $query: '#{$query} and (#{$and})';
  }

  @if ($media-type == 'all' and $query != '') {
    $media-type: '';
    $query: str-slice(unquote($query), 6);
  }

  @media #{$media-type + $query} {
    @content;
  }
}

